@use "sass:math";
@use "sass:map";

$defaults: (
  perspective: 40vh,
  y-distance: 10vh,
  z-distance: 10vh,
  turns: 1turn,
);

$tau: math.$pi * 2;

@mixin activated {
}

@mixin deactivated {
}

@function offset-index($index, $amount: 25) {
  @return $index - $amount;
}

@function radians($index) {
  @return math.div($tau * offset-index($index), 100);
}

@function y-value($index, $y-distance: map.get($defaults, y-distance)) {
  @return 0 - (math.cos(radians($index)) * $y-distance);
}

@function z-value($index, $scale-factor, $depth: 0) {
  @return (math.sin(radians($index)) * $scale-factor) + $depth;
}

@function rotation($index, $turns: map.get($defaults, turns)) {
  @return 0 - (math.div($index, 100) * $turns);
}

@mixin select-include($index, $direction) {
  @if $direction == "in" {
    @if $index == 0 {
      @include deactivated;
    }
    @if $index == 100 {
      @include activated;
    }
  }

  @if $direction == "out" {
    @if $index == 0 {
      @include activated;
    }
    @if $index == 100 {
      @include deactivated;
    }
  }
}

@mixin one-frame($index, $anim) {
  transform: perspective(map.get($defaults, perspective))
    translateY(y-value($index))
    translateZ(
      z-value(
        $index,
        map.get($defaults, z-distance),
        map.get($defaults, z-distance)
      )
    )
    rotateX(rotation($index));

  @include select-include($index, $anim);
}

@mixin frame-generator($anim, $step-size: 1) {
  @for $i from 0 through 100 {
    #{$i}% {
      @include one-frame($i, $anim);
    }
  }
}

$anims: "in", "out";

@each $anim in $anims {
  @keyframes rotate-#{$anim} {
    @include frame-generator($anim);
  }
}
